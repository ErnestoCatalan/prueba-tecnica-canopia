<!-- src/app/auth/register/register.component.html -->
<div class="register-container">
  <p-card header="Crear Cuenta" styleClass="register-card">
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      <div class="field">
        <label for="username">Nombre de Usuario</label>
        <input
          id="username"
          type="text"
          pInputText
          formControlName="username"
          placeholder="Mínimo 4 caracteres (letras, números, _)"
          [ngClass]="{
            'p-invalid': registerForm.get('username')?.invalid &&
                       (registerForm.get('username')?.dirty || registerForm.get('username')?.touched)
          }"
        />
        <small *ngIf="registerForm.get('username')?.invalid &&
                     (registerForm.get('username')?.dirty || registerForm.get('username')?.touched)"
               class="p-error">
          <span *ngIf="registerForm.get('username')?.hasError('required')">
            Nombre de usuario requerido
          </span>
          <span *ngIf="registerForm.get('username')?.hasError('minlength')">
            Mínimo 4 caracteres
          </span>
          <span *ngIf="registerForm.get('username')?.hasError('pattern')">
            Solo letras, números y guiones bajos
          </span>
        </small>
      </div>

      <div class="field">
        <label for="email">Correo Electrónico</label>
        <input
          id="email"
          type="email"
          pInputText
          formControlName="email"
          placeholder="ejemplo@correo.com"
          [ngClass]="{
            'p-invalid': registerForm.get('email')?.invalid &&
                       (registerForm.get('email')?.dirty || registerForm.get('email')?.touched)
          }"
        />
        <small *ngIf="registerForm.get('email')?.invalid &&
                     (registerForm.get('email')?.dirty || registerForm.get('email')?.touched)"
               class="p-error">
          <span *ngIf="registerForm.get('email')?.hasError('required')">
            Email requerido
          </span>
          <span *ngIf="registerForm.get('email')?.hasError('email')">
            Email no válido
          </span>
        </small>
      </div>

      <div class="field">
        <label for="password">Contraseña</label>
        <p-password
          id="password"
          formControlName="password"
          [feedback]="false"
          placeholder="Mínimo 6 caracteres"
          [ngClass]="{
            'p-invalid': registerForm.get('password')?.invalid &&
                       (registerForm.get('password')?.dirty || registerForm.get('password')?.touched)
          }"
        ></p-password>
        <small *ngIf="registerForm.get('password')?.invalid &&
                     (registerForm.get('password')?.dirty || registerForm.get('password')?.touched)"
               class="p-error">
          <span *ngIf="registerForm.get('password')?.hasError('required')">
            Contraseña requerida
          </span>
          <span *ngIf="registerForm.get('password')?.hasError('minlength')">
            Mínimo 6 caracteres
          </span>
        </small>
      </div>

      <div class="field">
        <label for="confirmPassword">Confirmar Contraseña</label>
        <p-password
          id="confirmPassword"
          formControlName="confirmPassword"
          [feedback]="false"
          placeholder="Repite tu contraseña"
          [ngClass]="{
            'p-invalid': registerForm.get('confirmPassword')?.invalid &&
                       (registerForm.get('confirmPassword')?.dirty || registerForm.get('confirmPassword')?.touched) ||
                       registerForm.hasError('mismatch') &&
                       (registerForm.get('confirmPassword')?.dirty || registerForm.get('confirmPassword')?.touched)
          }"
        ></p-password>
        <small *ngIf="(registerForm.get('confirmPassword')?.invalid || registerForm.hasError('mismatch')) &&
                     (registerForm.get('confirmPassword')?.dirty || registerForm.get('confirmPassword')?.touched)"
               class="p-error">
          <span *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
            Confirmación requerida
          </span>
          <span *ngIf="registerForm.hasError('mismatch')">
            Las contraseñas no coinciden
          </span>
        </small>
      </div>

      <button
        pButton
        type="submit"
        label="Registrarse"
        class="w-full mt-3"
        [disabled]="registerForm.invalid || loading"
        [loading]="loading"
      ></button>
    </form>
  </p-card>

  <p-card styleClass="login-redirect-card">
    <div class="flex align-items-center justify-content-center">
      <span>¿Ya tienes una cuenta?</span>
      <button
        pButton
        label="Iniciar Sesión"
        class="p-button-link ml-2"
        (click)="navigateToLogin()"
        [disabled]="loading"
      ></button>
    </div>
  </p-card>
</div>

<p-toast />
